<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<link rel="stylesheet" th:href="@{/css/common.css}">
<link rel="stylesheet" th:href="@{/css/header.css}">
<link rel="stylesheet" th:href="@{/css/footer.css}">
<link rel="stylesheet" th:href="@{/css/main.css}">

<div th:replace="~{fragments/header::header}" class="header"></div>
<div layout:fragment="content" id="wrap">
    <h2 hidden>박민영의 이력서</h2>
    <div class="ecoLogo_DateAndTime">
        <img th:src="@{/img/ecoLogo.png}" alt="ecoLogo" class="ecoLogo">
        <p th:text="${now}"></p>
    </div>

    <!--크롤링 테스트 -->
    <h2>크롤링 데이터 시험</h2>
    <p th:text="${crawlData}"></p>

    <div class="faceImgAndBasicInfo">
        <img th:src="@{/img/faceImg.png}" alt="faceImage" class="faceImg">
        <div class="basicInfoCard">
            <h2 class="basicInfoCard_title">안녕하세요 솔선수범한 개발자 박민영입니다.</h2>
            <p class="basicInfoCard_content">
                학부에서 프로그래밍을 전공하여 C#과 JavaScript 두 가지 언어를 함께 학습하면서 서로 다른 언어이지만 사용하는 방법은 비슷하다는 점을 알 수 있었기 때문에 새로운 언어에 도전할 수 있는 원동력이 되었습니다.
                학생 연구원에 참여하여 사용자 중심의 개발 방향성을 지향하게 되었으며, 개발자로서의 진로를 확고히 하였습니다.
                기획 및 디자이너와 협업 할 수 있는 기회가 있어, 졸업 작품으로 서비스 웹사이트를 제작했습니다.
                이후 백엔드 개발자로서 전문성을 키우기 위해 한국정보교육원에서 6개월 간 학습하였습니다.
                언어로는 Java, JavaScript, DB로는 MySQL, MariaDB, Oracle, 그리고 Spring Boot를 학습하며 총 3개의 프로젝트를 진행했습니다.
                그 중, 2차와 3차 팀 프로젝트에서는 팀장 역할을 맡아 프로젝트를 이끌었습니다.
                이러한 경험을 통해 기술적 역량 뿐만 아니라 팀워크와 리더십 역량 또한 키울 수 있었습니다. 감사합니다.
            </p>
            <!--
            <table class="BasicInfoTable">
                <tr>
                    <td>이름</td>
                    <td>박민영</td>
                    <td>생년월일</td>
                    <td>1997년 12월 01일 (만 27세)</td>
                </tr>
                <tr>
                    <td>전화</td>
                    <td>010-3706-9303</td>
                    <td>Email</td>
                    <td>sera0465@naver.com</td>
                </tr>
                <tr>
                    <td>주소</td>
                    <td colspan="3">경기도 성남시 분당구 삼평동 봇들마을 9단지 908-1103호</td>
                </tr>
                <tr>
                    <td>지원분야</td>
                    <td>백엔드 개발</td>
                    <td>희망연봉</td>
                    <td>회사내규에 따라 다름</td>
                </tr>
            </table>
            -->
        </div>
    </div>

    <h2 class="">Info</h2>
    <div class="subInfo">
            <ul class="info_box">
                <li class="info_box_title">About Me</li>
                <li>박민영</li>
                <li>1997.12.01</li>
                <li>계원예술대학교 디지털미디어디자인학과 졸업</li>
                <li>세부전공: 프로그래밍 전공</li>
            </ul>

<!--            <ul class="info_box">-->
<!--                <li class="info_box_title">Channel</li>-->
<!--                <li>깃허브 주소: https://github.com/judy78799</li>-->
<!--                <li>기술 블로그: https://judy0465.tistory.com/</li>-->
<!--            </ul>-->
            <ul class="info_box">
                <li class="info_box_title">학부활동</li>
                <li>1학년 2학기 과대</li>
                <li>학생연구원</li>
                <li>2학년 1,2학기 성적장학금</li>
                <li>도서 마일리지 학과 대표 선정</li>
            </ul>
            <ul class="info_box">
                <li class="info_box_title">Educatoin & Study</li>
                <li>한국정보교육원[SQF기반] 자바 스프링으로 완성하는 공공데이터 활용 백엔드 개발자 양성</li>
                <li>월간 CS – React Deep Dive 발표형 스터디</li>
                <li>CS 기상 스터디</li>
            </ul>

            <ul class="info_box">
                <li class="info_box_title">Work</li>
                <li>원더랩(One the Lab) 학생연구원</li>
            </ul>
    </div>

    <div class="skillInfo">
        <h2 class="skillInfo_title">● Skill</h2>
        <div class="btn_box">
            <button class="skillInfo_btn">한눈에 보기</button>
            <button class="skillInfo_btn">기술 설명</button>
        </div>
    </div>

    <div class="projects">

    </div>

    <h4>전체 URL을 입력하면 결과값이 도출되어 나옵니다.</h4>
    <input type="text" id="nameInput" placeholder="전체 URL을 입력해주세요. (따옴표 상관 없이)" />
    <button id="fetchImageButton">가져오기</button>
    <div id="imageContainer"></div>     <!-- 이미지 표시할 영역 -->
    <div id="textContainer"></div>      <!-- 텍스트 표시할 영역 -->

</div>
<div th:replace="~{fragments/footer::footer}"></div>
<th:block layout:fragment="script">
    <script>
        document.getElementById('fetchImageButton').addEventListener('click', function() {

            //전체 URl을 입력 받았을 때의 문제 풀이(한글이름까지)
             let urlVal = document.getElementById('nameInput').value;
             urlVal = urlVal.replace(/^["']|["']$/g, ''); // 사용자가 따옴표를 입력하였을 경우, 문자열의 시작과 끝에서 따옴표 제거
             const url = new URL(urlVal); //Url 파싱

             // 쿼리 파라미터 가져오기
            const params = new URLSearchParams(url.search);

            // 한글 인코딩 (여기서는 "name" 파라미터를 인코딩하는 예시)
            if (params.has('name')) {
                const nameValue = params.get('name');
                params.set('name', encodeURIComponent(nameValue)); // 한글만 인코딩
            }

            // 인코딩된 쿼리 파라미터로 새로운 URL 생성
            url.search = params.toString(); // 인코딩된 파라미터로 업데이트
            const finalUrl = url.toString(); // 최종 URL

            console.log("인코딩된 URL:", finalUrl); // 최종 URL 확인

            fetch('/uploadImageUrl', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ imgUrl: finalUrl }) // 인코딩된 URL을 JSON 형식으로 전송한다.
            }) //이 부분 이후에 서버(컨트롤러)로 갔다가 접두사를 붙인 JSON 데이터를 가지고 반환함.
             .then(response => {
                if (!response.ok) {
                    // 응답이 성공적이지 않은 경우 에러 처리.
                    throw new Error('Network response was not ok: ' + response.statusText);
                }
                return response.json(); // JSON 응답 받기.(접두사 붙인 JSON 데이터임.)
                })
              .then(data => {
                 if (data.img) { // img 키가 존재하는지 확인.
                    const base64Image = data.img; // img 키의 Base64 문자열을 가져옴.(접두사가 붙은 상태)
                    const imgElement = document.createElement('img');
                    imgElement.src = base64Image; // Base64 이미지를 img 태그에 설정.
                    imgElement.alt = 'Fetched Image'; // 이미지 설명 추가.

                    // 기존 이미지를 제거하고 새 이미지를 추가하여 최신 상태 유지.
                    const imageContainer = document.getElementById('imageContainer');
                    imageContainer.innerHTML = ''; // 기존 이미지를 제거.
                    imageContainer.appendChild(imgElement); // 새 이미지를 추가.

                        //최종 img 태그의 src 값에 추가되는 형태를 출력해보자.
                        console.log("최종 img태그의 src에 추가되는 base64Image 값은? => " + base64Image);
                } else {
                    console.error('응답에 img 키가 없습니다', data); // JSON 데이터에 img 키가 없을 경우 에러 반환.
                    alert('서버 응답에 이미지 정보가 없음.');
                }
                if(data.text){
                    const textVal = data.text; // text 키의 문자열을 가져옴.
                    const textElement = document.createElement('h5');   //동적으로 생성
                    textElement.innerHTML = textVal;

                    const textContainer = document.getElementById('textContainer');
                    textContainer.innerHTML = ''; // 기존 text 키의 값을 제거.
                    textContainer.appendChild(textElement); // 새 text를 추가.
                }else{
                    console.log("text 값이 존재하지 않습니다.");
                     alert('서버 응답에 텍스트 정보가 없음.');
                }

            })
            .catch((error) => {
                console.error('Error:', error);
                alert('해당 면접자가 아닙니다.\n'+ error.message); // 사용자에게 오류 메시지 표시
            });
        });
    </script>
</th:block>


</html>